const BODY=document.querySelector("body"),API_URL="https://rafaelbastidas.com/apis/api-music/app.php",FORM_LOGIN=document.getElementById("login"),BTN_SUBMIT=document.getElementById("btnSubmit"),REQUEST_STATUS=document.getElementById("textStatus"),INPUT_EMAIL=document.getElementById("inputEmail");var setVh=()=>{let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)},createSwitchesCollapse=()=>{let e=document.querySelectorAll('[data-trigger="collapse"]');for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>{checkState(e[t])}))};function checkState(e){changeTextBtnSubmit(),FORM_LOGIN.querySelectorAll("[data-state]").forEach((e=>{"collapsed"===e.getAttribute("data-state")?expandElement(e):collapseElement(e)}))}function collapseElement(e){e.animate([{height:`${e.scrollHeight}px`},{height:0}],{duration:400,easing:"ease"}),e.setAttribute("data-state","collapsed")}function expandElement(e){e.animate([{height:0},{height:`${e.scrollHeight}px`}],{duration:400,easing:"ease"}),e.setAttribute("data-state","expanded")}function changeTextBtnSubmit(){REQUEST_STATUS.classList.remove("show"),"Iniciar sesión"===BTN_SUBMIT.innerText?(BTN_SUBMIT.innerText="Crear usuario",INPUT_EMAIL.setAttribute("required","")):(BTN_SUBMIT.innerText="Iniciar sesión",INPUT_EMAIL.removeAttribute("required"))}var loginUser=async e=>{try{const t=new FormData;t.append("url","contenido"),t.append("params","autenticar"),t.append("data",JSON.stringify({user:e.user.value,password:e.password.value}));const a=await fetch(`${API_URL}`,{method:"POST",headers:{KEY_MUSIC:"Z9AQBQXUWDHRN5GYE3DUG52BTSFT1NMA"},body:t}),s=(await a.json()).response.respuesta;"Usuario no registrado"!==s&&"Contraseña incorrecta"!==s?(sessionStorage.setItem("userId",s),window.location.href="./user/"):(REQUEST_STATUS.innerText=s,REQUEST_STATUS.classList.remove("form__text--success"),REQUEST_STATUS.classList.add("show","form__text--error"))}catch(e){console.error(`Hubo un problema con la petición Fetch: Error ${e.status}: ${e.statusText}`)}},createUser=async e=>{try{const t=new FormData;t.append("url","contenido"),t.append("params","registrar"),t.append("data",JSON.stringify({user:e.user.value,password:e.password.value,email:e.email.value,name:"",bio:""}));const a=await fetch(`${API_URL}`,{method:"POST",headers:{KEY_MUSIC:"Z9AQBQXUWDHRN5GYE3DUG52BTSFT1NMA"},body:t}),s=(await a.json()).response.respuesta;"El usuario ya se encuentra registrado"!==s?setTimeout((()=>{REQUEST_STATUS.innerText="¡Usuario registrado!",REQUEST_STATUS.classList.add("show","form__text--success"),sessionStorage.setItem("userId",s),window.location.href="./user/"}),3e3):(REQUEST_STATUS.innerText=s,REQUEST_STATUS.classList.remove("form__text--success"),REQUEST_STATUS.classList.add("show","form__text--error"))}catch(e){console.error(`Hubo un problema con la petición Fetch: Error ${e.status}: ${e.statusText}`)}},getDataUser=async e=>{try{let t=new FormData;t.append("url","contenido"),t.append("params","get-init"),t.append("data",JSON.stringify({id_user:e}));const a=await fetch(`${API_URL}`,{method:"POST",body:t,headers:{KEY_MUSIC:"Z9AQBQXUWDHRN5GYE3DUG52BTSFT1NMA"}}),s=await a.json();console.log(s.response)}catch(e){console.error(`Hubo un problema con la petición Fetch: Error ${e.status}: ${e.statusText}`)}},listenerSubmitEvent=()=>{FORM_LOGIN.addEventListener("submit",(e=>{e.preventDefault(),"Crear usuario"===BTN_SUBMIT.innerText?createUser(e.currentTarget):loginUser(e.currentTarget)}))},checkIdUser=()=>{sessionStorage.getItem("userId")&&getDataUser(sessionStorage.getItem("userId"))};window.addEventListener("load",(()=>{setVh(),listenerSubmitEvent(),createSwitchesCollapse()}));